{"version":3,"file":"index.mjs","sources":["../../../plugins/exporter-curl/src/index.ts"],"sourcesContent":["import { HttpRequest } from '../../../src-web/lib/models';\n\nconst NEWLINE = '\\\\\\n ';\n\nexport function pluginHookExport(_: any, request: Partial<HttpRequest>) {\n  const xs = ['curl'];\n\n  // Add method and URL all on first line\n  if (request.method) xs.push('-X', request.method);\n  if (request.url) xs.push(quote(request.url));\n\n  xs.push(NEWLINE);\n\n  // Add URL params\n  for (const p of (request.urlParameters ?? []).filter(onlyEnabled)) {\n    xs.push('--url-query', quote(`${p.name}=${p.value}`));\n    xs.push(NEWLINE);\n  }\n\n  // Add headers\n  for (const h of (request.headers ?? []).filter(onlyEnabled)) {\n    xs.push('--header', quote(`${h.name}: ${h.value}`));\n    xs.push(NEWLINE);\n  }\n\n  // Add form params\n  if (Array.isArray(request.body?.form)) {\n    const flag = request.bodyType === 'multipart/form-data' ? '--form' : '--data';\n    for (const p of (request.body?.form ?? []).filter(onlyEnabled)) {\n      if (p.file) {\n        let v = `${p.name}=@${p.file}`;\n        v += p.contentType ? `;type=${p.contentType}` : '';\n        xs.push(flag, v);\n      } else {\n        xs.push(flag, quote(`${p.name}=${p.value}`));\n      }\n      xs.push(NEWLINE);\n    }\n  } else if (typeof request.body?.text === 'string') {\n    // --data-raw $'...' to do special ANSI C quoting\n    xs.push('--data-raw', `$${quote(request.body.text)}`);\n    xs.push(NEWLINE);\n  }\n\n  // Add basic/digest authentication\n  if (request.authenticationType === 'basic' || request.authenticationType === 'digest') {\n    if (request.authenticationType === 'digest') xs.push('--digest');\n    xs.push(\n      '--user',\n      quote(`${request.authentication?.username ?? ''}:${request.authentication?.password ?? ''}`),\n    );\n    xs.push(NEWLINE);\n  }\n\n  // Add bearer authentication\n  if (request.authenticationType === 'bearer') {\n    xs.push('--header', quote(`Authorization: Bearer ${request.authentication?.token ?? ''}`));\n    xs.push(NEWLINE);\n  }\n\n  // Remove trailing newline\n  if (xs[xs.length - 1] === NEWLINE) {\n    xs.splice(xs.length - 1, 1);\n  }\n\n  return xs.join(' ');\n}\n\nfunction quote(arg: string): string {\n  const escaped = arg.replace(/'/g, \"\\\\'\");\n  return `'${escaped}'`;\n}\n\nfunction onlyEnabled(v: { name?: string; enabled?: boolean }): boolean {\n  return v.enabled !== false && !!v.name;\n}\n"],"names":["NEWLINE","pluginHookExport","_","request","_a","_b","_c","_d","_e","_f","xs","quote","p","onlyEnabled","h","flag","v","arg"],"mappings":"AAEA,MAAMA,IAAU;AAAA;AAEA,SAAAC,EAAiBC,GAAQC,GAA+B;AAFxE,MAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC;AAGQ,QAAAC,IAAK,CAAC,MAAM;AAGlB,EAAIP,EAAQ,UAAWO,EAAA,KAAK,MAAMP,EAAQ,MAAM,GAC5CA,EAAQ,OAAKO,EAAG,KAAKC,EAAMR,EAAQ,GAAG,CAAC,GAE3CO,EAAG,KAAKV,CAAO;AAGf,aAAWY,MAAMT,EAAQ,iBAAiB,IAAI,OAAOU,CAAW;AAC3D,IAAAH,EAAA,KAAK,eAAeC,EAAM,GAAGC,EAAE,IAAI,IAAIA,EAAE,KAAK,EAAE,CAAC,GACpDF,EAAG,KAAKV,CAAO;AAIjB,aAAWc,MAAMX,EAAQ,WAAW,IAAI,OAAOU,CAAW;AACrD,IAAAH,EAAA,KAAK,YAAYC,EAAM,GAAGG,EAAE,IAAI,KAAKA,EAAE,KAAK,EAAE,CAAC,GAClDJ,EAAG,KAAKV,CAAO;AAIjB,MAAI,MAAM,SAAQI,IAAAD,EAAQ,SAAR,gBAAAC,EAAc,IAAI,GAAG;AACrC,UAAMW,IAAOZ,EAAQ,aAAa,wBAAwB,WAAW;AAC1D,eAAAS,QAAMP,IAAAF,EAAQ,SAAR,gBAAAE,EAAc,SAAQ,CAAI,GAAA,OAAOQ,CAAW,GAAG;AAC9D,UAAID,EAAE,MAAM;AACV,YAAII,IAAI,GAAGJ,EAAE,IAAI,KAAKA,EAAE,IAAI;AAC5B,QAAAI,KAAKJ,EAAE,cAAc,SAASA,EAAE,WAAW,KAAK,IAC7CF,EAAA,KAAKK,GAAMC,CAAC;AAAA,MAAA;AAEZ,QAAAN,EAAA,KAAKK,GAAMJ,EAAM,GAAGC,EAAE,IAAI,IAAIA,EAAE,KAAK,EAAE,CAAC;AAE7C,MAAAF,EAAG,KAAKV,CAAO;AAAA,IACjB;AAAA,EACS;AAAA,IAAA,SAAOM,IAAAH,EAAQ,SAAR,gBAAAG,EAAc,SAAS,aAEpCI,EAAA,KAAK,cAAc,IAAIC,EAAMR,EAAQ,KAAK,IAAI,CAAC,EAAE,GACpDO,EAAG,KAAKV,CAAO;AAIjB,UAAIG,EAAQ,uBAAuB,WAAWA,EAAQ,uBAAuB,cACvEA,EAAQ,uBAAuB,YAAUO,EAAG,KAAK,UAAU,GAC5DA,EAAA;AAAA,IACD;AAAA,IACAC,EAAM,KAAGJ,IAAAJ,EAAQ,mBAAR,gBAAAI,EAAwB,aAAY,EAAE,MAAIC,IAAAL,EAAQ,mBAAR,gBAAAK,EAAwB,aAAY,EAAE,EAAE;AAAA,EAAA,GAE7FE,EAAG,KAAKV,CAAO,IAIbG,EAAQ,uBAAuB,aAC9BO,EAAA,KAAK,YAAYC,EAAM,2BAAyBF,IAAAN,EAAQ,mBAAR,gBAAAM,EAAwB,UAAS,EAAE,EAAE,CAAC,GACzFC,EAAG,KAAKV,CAAO,IAIbU,EAAGA,EAAG,SAAS,CAAC,MAAMV,KACxBU,EAAG,OAAOA,EAAG,SAAS,GAAG,CAAC,GAGrBA,EAAG,KAAK,GAAG;AACpB;AAEA,SAASC,EAAMM,GAAqB;AAElC,SAAO,IADSA,EAAI,QAAQ,MAAM,KAAK,CACrB;AACpB;AAEA,SAASJ,EAAYG,GAAkD;AACrE,SAAOA,EAAE,YAAY,MAAS,CAAC,CAACA,EAAE;AACpC;"}